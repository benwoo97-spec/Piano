<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Muscle Quiz with No Duplicates</title>
<style>
body { font-family: Arial; background:#f0f4f9; display:flex; justify-content:center; align-items:center; min-height:100vh; margin:0; }
.screen { display:none; flex-direction:column; align-items:center; }
.screen.active { display:flex; }
button { margin:10px; padding:12px 20px; border:none; background:#4a90e2; color:white; border-radius:6px; cursor:pointer; font-size:16px; }
button:hover {background:#357ab7;}
.quiz-container { background:white; padding:20px 30px; border-radius:12px; width:90%; max-width:500px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.15);}
.option { background:#e9eff5; padding:12px; margin:8px 0; border-radius:8px; cursor:pointer; font-size:16px; }
.option.selected { background:#ffd966; }
.option.correct { background:#b4f1b4 !important; }
.option.wrong { background:#f7b4b4 !important; }
#feedback, #prevFeedback, #progress { font-weight:bold; margin-top:10px; min-height:24px;}
</style>
</head>
<body>

<div id="mainScreen" class="screen active">
  <h1>Piano's Quiz</h1>
  <button onclick="showSettings('gluteal')">Gluteal Region</button>
  <button onclick="showSettings('trunk')">Trunk & Anterior Thigh</button>
  <button onclick="showSettings('all')">All Regions</button>
</div>

<div id="settingsScreen" class="screen">
  <h2>Select Number of Questions</h2>
  <button onclick="startQuiz(10)">10</button>
  <button onclick="startQuiz(30)">30</button>
  <button onclick="startQuiz(50)">50</button>
  <button onclick="startQuiz('all')">All</button>
</div>

<div id="quizScreen" class="screen">
  <div class="quiz-container">
    <div id="prevFeedback"></div>
    <div id="progress"></div>
    <h2 id="question">Loading...</h2>
    <div id="options"></div>
    <p id="feedback"></p>
    <button onclick="submitAnswer()" id="submitBtn">Submit Answer</button>
    <button onclick="nextQuestion()" id="nextBtn">Next</button>
    <p>Score: <span id="score">0</span></p>
    <button id="reviewButton" style="display:none;" onclick="reviewWrong()">üîÑ Review Wrong Questions</button>
    <button id="homeButton" style="display:none;" onclick="goHome()">üè† Home</button>
  </div>
</div>

<script>
// Muscle data
const glutealData = [
  {muscle:"Gluteus Maximus", origin:"Ilium, sacrum, coccyx, sacrotuberous ligament", insertion:"Gluteal tuberosity, iliotibial tract (IT Band)", action:"Hip ER, EXT", nerve:"Inferior gluteal n. (VR L5-S2)", perfusion:"Superior and Inferior gluteal aa/vv"},
  {muscle:"Gluteus Medius", origin:"Anterior and Posterior gluteal lines (Ilium)", insertion:"Greater trochanter", action:"Hip IR, ABD + Hip stabilization", nerve:"Superior gluteal n. (VR L4-S1)", perfusion:"Superior gluteal aa/vv"},
  {muscle:"Gluteus Minimus", origin:"Anterior and Inferior gluteal lines (Ilium)", insertion:"Greater trochanter", action:"Hip IR, ABD + Hip stabilization", nerve:"Superior gluteal n. (VR L4-S1)", perfusion:"Superior gluteal aa/vv"},
  {muscle:"Piriformis", origin:"Anterior surface of sacrum, Sacrotuberous ligament", insertion:"Greater trochanter (upper end)", action:"Hip ER", nerve:"n. to piriformis mm. (VR S1-S2)", perfusion:"Superior and Inferior gluteal aa/vv"},
  {muscle:"Superior Gemellus", origin:"Ischial spine", insertion:"Greater trochanter (via obturator internus tendon)", action:"Hip ER", nerve:"n. to superior gemellus and obturator internus mm. (VR L5-S2)", perfusion:"Inferior Gluteal aa/vv"},
  {muscle:"Obturator Internus", origin:"Ischiopubic ramus, Obturator membrane", insertion:"Greater trochanter", action:"Hip ER, ABD", nerve:"n. to superior gemellus and obturator internus mm. (VR L5-S2)", perfusion:"Inferior Gluteal aa/vv"},
  {muscle:"Inferior Gemellus", origin:"Ischial tuberosity", insertion:"Greater trochanter (via obturator internus tendon)", action:"Hip ER", nerve:"n. to inferior gemellus and Quadratus Femoris mm. (VR L4-S1)", perfusion:"Inferior Gluteal aa/vv"},
  {muscle:"Quadratus Femoris", origin:"Ischial tuberosity", insertion:"Intertrochanteric crest", action:"Hip ER", nerve:"n. to inferior gemellus and Quadratus Femoris mm. (VR L4-S1)", perfusion:"Inferior Gluteal aa/vv"}
];

const trunkData = [
  {muscle:"Psoas Major", origin:"Transverse process (TP), Intervertebral Disks (IVD) and Bodies of T12-L5", insertion:"Lesser Trochanter", action:"Hip FLX, Trunk FLX", nerve:"VR T12 Subcostal n. + L1-L3 spinal n.", perfusion:"12th Anterior Intercostal aa/vv ; #1-3 Lumbar aa/vv"},
  {muscle:"Psoas Minor", origin:"Intervertebral Disks (IVD), and bodies of T12-L1", insertion:"Lesser Trochanter", action:"aids in Trunk FLX", nerve:"VR T12 Subcostal n. + L1 spinal n.", perfusion:"12th Anterior Intercostal aa/vv ; #1-3 Lumbar aa/vv"},
  {muscle:"Iliacus", origin:"Iliac fossa, Ala of sacrum", insertion:"Lesser Trochanter", action:"Hip FLX", nerve:"VR L2-L4 femoral n.", perfusion:"External Iliac aa/vv"},
  {muscle:"Iliopsoas", origin:"Iliac fossa, Ala of sacrum, TP, IVD, and bodies of T12-L5", insertion:"Lesser Trochanter", action:"Hip FLX", nerve:"VR L2-L4 femoral n.", perfusion:"Femoral aa/vv"},
  {muscle:"Sartorius", origin:"ASIS", insertion:"Pes Anserine (medial side of tibia bone)", action:"Hip FLX, ER, ABD + Leg IR, FLX", nerve:"VR L2-L4 femoral n.", perfusion:"Femoral aa/vv"},
  {muscle:"Rectus Femoris", origin:"AIIS, posterior-superior rim of acetabulum", insertion:"base of patella, tibial tuberosity", action:"Hip FLX, and leg EXT", nerve:"VR L2-L4 femoral n.", perfusion:"Femoral aa/vv"},
  {muscle:"Vastus Medialis", origin:"Intertrochanteric line, linea aspera, medial intermuscular septum", insertion:"medial side of patella, tibial tuberosity", action:"Leg EXT", nerve:"VR L2-L4 femoral n.", perfusion:"Femoral aa/vv"},
  {muscle:"Vastus Lateralis", origin:"Intertrochanteric line, linea aspera, lateral intermuscular septum, greater trochanter, gluteal tuberosity", insertion:"lateral side of patella, tibial tuberosity", action:"Leg EXT", nerve:"VR L2-L4 femoral n.", perfusion:"Femoral aa/vv"},
  {muscle:"Vastus Intermedius", origin:"upper shaft of femur, lower lateral intermuscular septum", insertion:"upper border of patella, tibial tubeosity", action:"Leg EXT", nerve:"VR L2-L4 femoral n.", perfusion:"Femoral aa/vv"},
  {muscle:"Articularis Genu", origin:"Distal Femur (Anterior portion)", insertion:"suprapatellar bursa", action:"Pulls suprapatellar tendon superiorly", nerve:"VR L2-L4 femoral n.", perfusion:"Femoral aa/vv"},
  {muscle:"Pectineus", origin:"pectineal line of pubis bone", insertion:"pectineal line of femur bone", action:"Hip FLX, ADD", nerve:"VR L2-L4 femoral n. + VR L2-L4 obturator n.", perfusion:"Femoral aa/vv + Obturator aa/vv"}
];

let selectedDataset = glutealData;
let quizPool=[], currentIndex=0, score=0, selectedOptions=[], currentCorrect=[], prevFeedbackText="", answerSubmitted=false;
let wrongQuestions=[];
const attributes = ["origin","insertion","action","nerve","perfusion"];
let muscles = selectedDataset.map(m=>m.muscle);

function showScreen(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }

function showSettings(dataset){
  if(dataset==='gluteal') selectedDataset = glutealData;
  else if(dataset==='trunk') selectedDataset = trunkData;
  else selectedDataset = [...glutealData, ...trunkData];
  muscles = selectedDataset.map(m=>m.muscle);
  showScreen('settingsScreen');
}

function goHome(){ showScreen('mainScreen'); }

function startQuiz(num){
  score = 0; currentIndex = 0; answerSubmitted = false; prevFeedbackText = ""; wrongQuestions = [];
  document.getElementById("reviewButton").style.display = "none";
  document.getElementById("homeButton").style.display = "none";
  document.getElementById("submitBtn").style.display = "inline-block";
  document.getElementById("nextBtn").style.display = "inline-block";

  let tempPool = [];
  selectedDataset.forEach(m=>{
    attributes.forEach(attr=>{
      const useReverse = Math.random() < 0.5;
      tempPool.push({muscle:m.muscle, attr:attr, answer:m[attr], reverse:useReverse});
    });
  });

  quizPool = shuffleArray(tempPool);
  if(num !== 'all') quizPool = quizPool.slice(0, num);

  showScreen('quizScreen');
  initOptionDivs();
  loadQuestion();
}

function initOptionDivs(){
  const optionsDiv=document.getElementById("options");
  optionsDiv.innerHTML="";
  for(let i=0;i<4;i++){
    let div=document.createElement("div");
    div.className="option";
    div.onclick=()=>toggleOption(div);
    optionsDiv.appendChild(div);
  }
}

function loadQuestion(){
  if(currentIndex >= quizPool.length){
    prevFeedbackText = "";
    document.getElementById("prevFeedback").innerText = "";
    document.getElementById("question").innerText = "üéâ Quiz Finished!";
    document.getElementById("options").innerHTML = "";
    document.getElementById("feedback").innerText = `Score: ${score}/${quizPool.length}`;
    document.getElementById("submitBtn").style.display = "none";
    document.getElementById("nextBtn").style.display = "none";
    if(wrongQuestions.length > 0) document.getElementById("reviewButton").style.display = "inline-block";
    document.getElementById("homeButton").style.display = "inline-block";
    return;
  }

  selectedOptions=[]; currentCorrect=[]; answerSubmitted=false;
  const q=quizPool[currentIndex];
  let questionText, optionsPool;

  if(!q.reverse){
    questionText = `${q.muscle}'s ${capitalize(q.attr)}?`;
    currentCorrect=[q.answer];
    optionsPool=getPool(q.attr);
  } else {
    questionText = `Which muscle has ${capitalize(q.attr)} '${q.answer}'?`;
    currentCorrect = selectedDataset.filter(m=>m[q.attr]===q.answer).map(m=>m.muscle);
    optionsPool=muscles;
  }

  let opts=[...currentCorrect];
  let shuffledPool=shuffleArray([...optionsPool]);
  for(let i=0;i<shuffledPool.length && opts.length<4;i++){
    if(!opts.includes(shuffledPool[i])) opts.push(shuffledPool[i]);
  }
  opts=shuffleArray(opts);

  document.getElementById("question").innerText=questionText;
  const optionDivs=document.querySelectorAll(".option");
  optionDivs.forEach((div,i)=>{ div.innerText=opts[i]; div.className="option"; });
  document.getElementById("prevFeedback").innerText=prevFeedbackText;
  document.getElementById("feedback").innerText="";
  document.getElementById("score").innerText=score;
  document.getElementById("progress").innerText=`Question ${currentIndex+1} of ${quizPool.length}`;
}

function toggleOption(div){
  if(answerSubmitted) return;
  if(div.classList.contains('selected')) { div.classList.remove('selected'); selectedOptions=selectedOptions.filter(o=>o!==div.innerText); }
  else { div.classList.add('selected'); selectedOptions.push(div.innerText); }
}

function submitAnswer(){
  if(answerSubmitted){ alert("You already submitted this question!"); return; }
  if(selectedOptions.length===0){ alert("Select at least one option!"); return; }
  answerSubmitted=true;

  const selectedSet=new Set(selectedOptions);
  const correctSet=new Set(currentCorrect);
  const isCorrect=selectedSet.size===correctSet.size && [...correctSet].every(ans=>selectedSet.has(ans));

  const optionDivs=document.querySelectorAll(".option");
  optionDivs.forEach(div=>{
    if(currentCorrect.includes(div.innerText)) div.classList.add("correct");
    else if(div.classList.contains("selected")) div.classList.add("wrong");
  });

  if(isCorrect){ document.getElementById("feedback").innerText="‚úÖ Correct!"; score++; prevFeedbackText="‚úÖ Previous: Correct!"; }
  else { document.getElementById("feedback").innerText="‚ùå Wrong! Correct: "+currentCorrect.join(", "); prevFeedbackText="‚ùå Previous: Wrong!"; wrongQuestions.push(quizPool[currentIndex]); }

  document.getElementById("score").innerText=score;
}

function nextQuestion(){
  if(!answerSubmitted){ alert("Please submit your answer before moving to the next question!"); return; }
  currentIndex++;
  loadQuestion();
}

function reviewWrong(){
  if(wrongQuestions.length === 0){ alert("No wrong questions to review!"); return; }
  quizPool = [...wrongQuestions];
  currentIndex = 0;
  score = 0;
  prevFeedbackText = "";
  wrongQuestions = [];
  document.getElementById("reviewButton").style.display = "none";
  document.getElementById("homeButton").style.display = "none";
  document.getElementById("submitBtn").style.display = "inline-block";
  document.getElementById("nextBtn").style.display = "inline-block";
  initOptionDivs();
  loadQuestion();
}

function getPool(attr){
  return [...new Set(selectedDataset.map(m=>m[attr]))];
}

function shuffleArray(array){return array.sort(()=>Math.random()-0.5);}
function capitalize(str){return str.charAt(0).toUpperCase()+str.slice(1);}
</script>
</body>
</html>
