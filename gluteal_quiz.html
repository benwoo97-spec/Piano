<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gluteal Muscle Quiz with No Duplicates</title>
<style>
body { font-family: Arial; background:#f0f4f9; display:flex; justify-content:center; align-items:center; min-height:100vh; margin:0; }
.screen { display:none; flex-direction:column; align-items:center; }
.screen.active { display:flex; }
button { margin:10px; padding:12px 20px; border:none; background:#4a90e2; color:white; border-radius:6px; cursor:pointer; font-size:16px; }
button:hover {background:#357ab7;}
.quiz-container { background:white; padding:20px 30px; border-radius:12px; width:90%; max-width:500px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.15);}
.option { background:#e9eff5; padding:12px; margin:8px 0; border-radius:8px; cursor:pointer; font-size:16px; }
.option.selected { background:#ffd966; }
.option.correct { background:#b4f1b4 !important; }
.option.wrong { background:#f7b4b4 !important; }
#feedback, #prevFeedback, #progress { font-weight:bold; margin-top:10px; min-height:24px;}
</style>
</head>
<body>

<div id="mainScreen" class="screen active">
  <h1>Piano's Quiz</h1>
  <button onclick="showSettings()">Gluteal Region</button>
</div>

<div id="settingsScreen" class="screen">
  <h2>Select Number of Questions</h2>
  <button onclick="startQuiz(10)">10</button>
  <button onclick="startQuiz(30)">30</button>
  <button onclick="startQuiz(50)">50</button>
  <button onclick="startQuiz('all')">All (80)</button>
</div>

<div id="quizScreen" class="screen">
  <div class="quiz-container">
    <div id="prevFeedback"></div>
    <div id="progress"></div>
    <h2 id="question">Loading...</h2>
    <div id="options"></div>
    <p id="feedback"></p>
    <button onclick="submitAnswer()" id="submitBtn">Submit Answer</button>
    <button onclick="nextQuestion()" id="nextBtn">Next</button>
    <p>Score: <span id="score">0</span></p>
    <button id="reviewButton" style="display:none;" onclick="reviewWrong()">üîÑ Review Wrong Questions</button>
    <button id="homeButton" style="display:none;" onclick="goHome()">üè† Home</button>
  </div>
</div>

<script>
// Muscle data
const quizData = [
  {muscle:"Gluteus Maximus", origin:"Ilium, sacrum, coccyx, sacrotuberous ligament", insertion:"Gluteal tuberosity, iliotibial tract (IT Band)", action:"Hip ER, EXT", nerve:"Inferior gluteal n. (VR L5-S2)", perfusion:"Superior and Inferior gluteal aa/vv"},
  {muscle:"Gluteus Medius", origin:"Anterior and Posterior gluteal lines (Ilium)", insertion:"Greater trochanter", action:"Hip IR, ABD + Hip stabilization", nerve:"Superior gluteal n. (VR L4-S1)", perfusion:"Superior gluteal aa/vv"},
  {muscle:"Gluteus Minimus", origin:"Anterior and Inferior gluteal lines (Ilium)", insertion:"Greater trochanter", action:"Hip IR, ABD + Hip stabilization", nerve:"Superior gluteal n. (VR L4-S1)", perfusion:"Superior gluteal aa/vv"},
  {muscle:"Piriformis", origin:"Anterior surface of sacrum, Sacrotuberous ligament", insertion:"Greater trochanter (upper end)", action:"Hip ER", nerve:"n. to piriformis mm. (VR S1-S2)", perfusion:"Superior and Inferior gluteal aa/vv"},
  {muscle:"Superior Gemellus", origin:"Ischial spine", insertion:"Greater trochanter (via obturator internus tendon)", action:"Hip ER", nerve:"n. to superior gemellus and obturator internus mm. (VR L5-S2)", perfusion:"Inferior Gluteal aa/vv"},
  {muscle:"Obturator Internus", origin:"Ischiopubic ramus, Obturator membrane", insertion:"Greater trochanter", action:"Hip ER, ABD", nerve:"n. to superior gemellus and obturator internus mm. (VR L5-S2)", perfusion:"Inferior Gluteal aa/vv"},
  {muscle:"Inferior Gemellus", origin:"Ischial tuberosity", insertion:"Greater trochanter (via obturator internus tendon)", action:"Hip ER", nerve:"n. to inferior gemellus and Quadratus Femoris mm. (VR L4-S1)", perfusion:"Inferior Gluteal aa/vv"},
  {muscle:"Quadratus Femoris", origin:"Ischial tuberosity", insertion:"Intertrochanteric crest", action:"Hip ER", nerve:"n. to inferior gemellus and Quadratus Femoris mm. (VR L4-S1)", perfusion:"Inferior Gluteal aa/vv"}
];

let quizPool=[], currentIndex=0, score=0, selectedOptions=[], currentCorrect=[], prevFeedbackText="", answerSubmitted=false;
let wrongQuestions=[]; // ÌãÄÎ¶∞ Î¨∏Ï†ú Ï†ÄÏû•
const attributes = ["origin","insertion","action","nerve","perfusion"];
const muscles = quizData.map(m=>m.muscle);

function showScreen(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
function showSettings(){ showScreen('settingsScreen'); }
function goHome(){ showScreen('mainScreen'); }

function startQuiz(num){
  score = 0;
  currentIndex = 0;
  answerSubmitted = false;
  prevFeedbackText = "";
  wrongQuestions = [];
  document.getElementById("reviewButton").style.display = "none";
  document.getElementById("homeButton").style.display = "none";
  document.getElementById("submitBtn").style.display = "inline-block";
  document.getElementById("nextBtn").style.display = "inline-block";

  // Ï§ëÎ≥µ Ï†úÍ±∞: muscle+attr Ï°∞Ìï© ÌïòÎÇòÏî©Îßå Î¨∏Ï†ú ÏÉùÏÑ±, reverse 50% ÎûúÎç§
  let tempPool = [];
  quizData.forEach(m=>{
    attributes.forEach(attr=>{
      const useReverse = Math.random() < 0.5;
      tempPool.push({muscle:m.muscle, attr:attr, answer:m[attr], reverse:useReverse});
    });
  });

  quizPool = shuffleArray(tempPool);
  if(num !== 'all') quizPool = quizPool.slice(0, num);

  showScreen('quizScreen');
  initOptionDivs();
  loadQuestion();
}

function initOptionDivs(){
  const optionsDiv=document.getElementById("options");
  optionsDiv.innerHTML="";
  for(let i=0;i<4;i++){
    let div=document.createElement("div");
    div.className="option";
    div.onclick=()=>toggleOption(div);
    optionsDiv.appendChild(div);
  }
}

function loadQuestion(){
  // ÌÄ¥Ï¶à Ï¢ÖÎ£å Ï≤òÎ¶¨
  if(currentIndex >= quizPool.length){
    prevFeedbackText = ""; // ‚Üê Ïù¥Ï†Ñ ÌîºÎìúÎ∞± Ï¥àÍ∏∞Ìôî
    document.getElementById("prevFeedback").innerText = "";
    document.getElementById("question").innerText = "üéâ Quiz Finished!";
    document.getElementById("options").innerHTML = "";
    document.getElementById("feedback").innerText = `Score: ${score}/${quizPool.length}`;
    document.getElementById("submitBtn").style.display = "none";
    document.getElementById("nextBtn").style.display = "none";
    if(wrongQuestions.length > 0) document.getElementById("reviewButton").style.display = "inline-block";
    document.getElementById("homeButton").style.display = "inline-block";
    return;
  }

  selectedOptions=[]; currentCorrect=[]; answerSubmitted=false;
  const q=quizPool[currentIndex];
  let questionText, optionsPool;

  if(!q.reverse){
    questionText = `${q.muscle}'s ${capitalize(q.attr)}?`;
    currentCorrect=[q.answer];
    optionsPool=getPool(q.attr);
  } else {
    questionText = `Which muscle has ${capitalize(q.attr)} '${q.answer}'?`;
    currentCorrect = quizData.filter(m=>m[q.attr]===q.answer).map(m=>m.muscle);
    optionsPool=muscles;
  }

  let opts=[...currentCorrect];
  let shuffledPool=shuffleArray([...optionsPool]);
  for(let i=0;i<shuffledPool.length && opts.length<4;i++){
    if(!opts.includes(shuffledPool[i])) opts.push(shuffledPool[i]);
  }
  opts=shuffleArray(opts);

  document.getElementById("question").innerText=questionText;
  const optionDivs=document.querySelectorAll(".option");
  optionDivs.forEach((div,i)=>{
    div.innerText=opts[i];
    div.className="option";
  });
  document.getElementById("prevFeedback").innerText=prevFeedbackText;
  document.getElementById("feedback").innerText="";
  document.getElementById("score").innerText=score;
  document.getElementById("progress").innerText=`Question ${currentIndex+1} of ${quizPool.length}`;
}

function toggleOption(div){
  if(answerSubmitted) return;
  if(div.classList.contains('selected')) { div.classList.remove('selected'); selectedOptions=selectedOptions.filter(o=>o!==div.innerText); }
  else { div.classList.add('selected'); selectedOptions.push(div.innerText); }
}

function submitAnswer(){
  if(answerSubmitted){ alert("You already submitted this question!"); return; }
  if(selectedOptions.length===0){ alert("Select at least one option!"); return; }
  answerSubmitted=true;

  const selectedSet=new Set(selectedOptions);
  const correctSet=new Set(currentCorrect);
  const isCorrect=selectedSet.size===correctSet.size && [...correctSet].every(ans=>selectedSet.has(ans));

  const optionDivs=document.querySelectorAll(".option");
  optionDivs.forEach(div=>{
    if(currentCorrect.includes(div.innerText)) div.classList.add("correct");
    else if(div.classList.contains("selected")) div.classList.add("wrong");
  });

  if(isCorrect){
    document.getElementById("feedback").innerText="‚úÖ Correct!";
    score++;
    prevFeedbackText="‚úÖ Previous: Correct!";
  } else {
    document.getElementById("feedback").innerText="‚ùå Wrong! Correct: "+currentCorrect.join(", ");
    prevFeedbackText="‚ùå Previous: Wrong!";
    wrongQuestions.push(quizPool[currentIndex]);
  }
  document.getElementById("score").innerText=score;
}

function nextQuestion(){
  if(!answerSubmitted){ alert("Please submit your answer before moving to the next question!"); return; }
  currentIndex++;
  loadQuestion();
}

function reviewWrong(){
  if(wrongQuestions.length === 0){ alert("No wrong questions to review!"); return; }
  quizPool = [...wrongQuestions];
  currentIndex = 0;
  score = 0;
  prevFeedbackText = "";
  wrongQuestions = [];
  document.getElementById("reviewButton").style.display = "none";
  document.getElementById("homeButton").style.display = "none";
  document.getElementById("submitBtn").style.display = "inline-block";
  document.getElementById("nextBtn").style.display = "inline-block";
  initOptionDivs();
  loadQuestion();
}

function getPool(attr){
  switch(attr){
    case "origin": return [...new Set(quizData.map(m=>m.origin))];
    case "insertion": return [...new Set(quizData.map(m=>m.insertion))];
    case "action": return [...new Set(quizData.map(m=>m.action))];
    case "nerve": return [...new Set(quizData.map(m=>m.nerve))];
    case "perfusion": return [...new Set(quizData.map(m=>m.perfusion))];
  }
}

function shuffleArray(array){return array.sort(()=>Math.random()-0.5);}
function capitalize(str){return str.charAt(0).toUpperCase()+str.slice(1);}
</script>
</body>
</html>
